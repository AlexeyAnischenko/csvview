п»ї<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CSV Viewer</title>
  <script src="https://unpkg.com/react@18.3.0/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18.3.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      content: ['./index.html'],
      theme: {
        extend: {},
      },
    }
  </script>
  <style>
    [data-tooltip] {
      position: relative;
    }
    [data-tooltip]:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      padding: 4px 8px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      border-radius: 4px;
      font-size: 12px;
      white-space: nowrap;
      z-index: 50;
      margin-bottom: 5px;
    }
    [data-tooltip-wide] {
      position: relative;
    }
    [data-tooltip-wide]:hover::after {
      content: attr(data-tooltip-wide);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      padding: 8px 12px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      border-radius: 4px;
      font-size: 12px;
      white-space: normal;
      width: 300px;
      text-align: center;
      z-index: 50;
      margin-bottom: 5px;
      line-height: 1.4;
    }
    .paste-area {
      position: fixed;
      top: -9999px;
      left: -9999px;
      opacity: 0;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <textarea id="pasteArea" class="paste-area"></textarea>
  <script type="text/babel">
    const { useState, useEffect, useMemo, StrictMode } = React;

    // Icons from Lucide (simplified SVG versions)
    const Icons = {
      Moon: () => (
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>
        </svg>
      ),
      Sun: () => (
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/>
        </svg>
      ),
      Upload: () => (
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/>
        </svg>
      ),
      Clipboard: () => (
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <rect width="8" height="4" x="8" y="2" rx="1" ry="1"/>
          <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/>
        </svg>
      ),
      Share: () => (
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/>
        </svg>
      ),
      ArrowUp: () => (
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="m5 12 7-7 7 7"/><path d="M12 19V5"/>
        </svg>
      ),
      ArrowDown: () => (
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="M12 5v14"/><path d="m19 12-7 7-7-7"/>
        </svg>
      ),
      ArrowLeft: () => (
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="m12 19-7-7 7-7"/><path d="M19 12H5"/>
        </svg>
      ),
      ArrowRight: () => (
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="M5 12h14"/><path d="m12 5 7 7-7 7"/>
        </svg>
      ),
      ChevronFirst: () => (
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="m17 18-6-6 6-6"/><path d="M7 6v12"/>
        </svg>
      ),
      ChevronLast: () => (
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="M7 18 13 12 7 6"/><path d="M17 6v12"/>
        </svg>
      ),
      ArrowUpDown: () => (
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="m21 16-4 4-4-4"/><path d="M17 20V4"/><path d="m3 8 4-4 4 4"/><path d="M7 4v16"/>
        </svg>
      ),
    };

    const separators = [
      { label: 'Comma', value: ',' },
      { label: 'Dot', value: '.' },
      { label: 'Colon', value: ':' },
      { label: 'Semicolon', value: ';' },
      { label: 'Pipe', value: '|' },
      { label: 'Tab', value: '\t' },
      { label: 'Space', value: ' ' },
    ];

    const columnWidthOptions = [
      { label: '10 chars', value: 10 },
      { label: '20 chars', value: 20 },
      { label: '30 chars', value: 30 },
      { label: '40 chars', value: 40 },
      { label: '50 chars', value: 50 },
      { label: '70 chars', value: 70 },
      { label: '80 chars', value: 80 },
      { label: '100 chars', value: 100 },
      { label: 'Unlimited', value: Infinity },
    ];

    function processHtmlContent(text) {
      if (!text) return { isLink: false, content: '' };
      const linkMatch = text.match(/<a\s+(?:[^>]*?\s+)?href="([^"]*)"[^>]*>(.*?)<\/a>/);
      if (linkMatch) {
        const fullContent = text;
        const linkHtml = linkMatch[0];
        const url = linkMatch[1];
        const label = linkMatch[2];
        const parts = text.split(linkHtml);
        const beforeText = parts[0].trim();
        const afterText = parts[1]?.trim();
        return {
          isLink: true,
          url,
          label,
          beforeText,
          afterText,
          fullContent
        };
      }
      return { isLink: false, content: text };
    }

    // URL parameter utilities
    const updateUrlParams = (params) => {
      const url = new URL(window.location.href);
      Object.entries(params).forEach(([key, value]) => {
        if (value === null || value === undefined || value === '') {
          url.searchParams.delete(key);
        } else {
          url.searchParams.set(key, String(value));
        }
      });
      window.history.replaceState({}, '', url);
    };

    const getUrlParams = () => {
      const params = new URLSearchParams(window.location.search);
      return {
        url: params.get('url') || '',
        pageSize: parseInt(params.get('pageSize')) || 50,
        separator: params.get('separator') || ',',
        andFilter: params.get('andFilter') || '',
        orFilter: params.get('orFilter') || '',
        notFilter: params.get('notFilter') || '',
        caseSensitive: params.get('caseSensitive') === 'true',
        maxColumnWidth: params.get('maxColumnWidth') === 'Infinity' ? Infinity : parseInt(params.get('maxColumnWidth')) || 50,
        theme: params.get('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'),
        collapsedCols: params.get('collapsedCols') ? params.get('collapsedCols').split(',').map(Number) : [],
        sortColumn: parseInt(params.get('sortColumn')) || -1,
        sortDirection: params.get('sortDirection') || 'asc',
        currentPage: parseInt(params.get('currentPage')) || 1
      };
    };

    // Helpers for numeric-aware sorting
    const isNumericValue = (v) => {
      if (v === null || v === undefined) return false;
      const s = String(v).trim();
      if (s === '' || s.toUpperCase() === 'N/A') return false;
      const n = Number(s);
      return Number.isFinite(n);
    };
    const toNumber = (v) => Number(String(v).trim());

    function App() {
      // Initialize state from URL parameters
      const urlParams = getUrlParams();
      
      const [theme, setTheme] = useState(urlParams.theme);
      const [csvData, setCSVData] = useState({ headers: [], rows: [] });
      const [fileUrl, setFileUrl] = useState(urlParams.url);
      const [showUrlInput, setShowUrlInput] = useState(false);
      const [pageSize, setPageSize] = useState(urlParams.pageSize);
      const [currentPage, setCurrentPage] = useState(urlParams.currentPage);
      const [andFilter, setAndFilter] = useState(urlParams.andFilter);
      const [orFilter, setOrFilter] = useState(urlParams.orFilter);
      const [notFilter, setNotFilter] = useState(urlParams.notFilter);
      const [sortColumn, setSortColumn] = useState(urlParams.sortColumn);
      const [sortDirection, setSortDirection] = useState(urlParams.sortDirection);
      const [columnOrder, setColumnOrder] = useState([]);
      const [draggedColumn, setDraggedColumn] = useState(null);
      const [separator, setSeparator] = useState(urlParams.separator);
      const [caseSensitive, setCaseSensitive] = useState(urlParams.caseSensitive);
      const [debouncedAndFilter, setDebouncedAndFilter] = useState(urlParams.andFilter);
      const [debouncedOrFilter, setDebouncedOrFilter] = useState(urlParams.orFilter);
      const [debouncedNotFilter, setDebouncedNotFilter] = useState(urlParams.notFilter);
      const [dragOverColumn, setDragOverColumn] = useState(null);
      const [scrollPosition, setScrollPosition] = useState(0);
      const [maxColumnWidth, setMaxColumnWidth] = useState(urlParams.maxColumnWidth);
      const [collapsedCols, setCollapsedCols] = useState(() => new Set(urlParams.collapsedCols));

      // Update URL whenever state changes
      useEffect(() => {
        updateUrlParams({
          theme: theme !== (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') ? theme : null,
          url: fileUrl || null,
          pageSize: pageSize !== 50 ? pageSize : null,
          separator: separator !== ',' ? separator : null,
          andFilter: andFilter || null,
          orFilter: orFilter || null,
          notFilter: notFilter || null,
          caseSensitive: caseSensitive ? 'true' : null,
          maxColumnWidth: maxColumnWidth !== 50 ? (maxColumnWidth === Infinity ? 'Infinity' : maxColumnWidth) : null,
          collapsedCols: collapsedCols.size > 0 ? Array.from(collapsedCols).join(',') : null,
          sortColumn: sortColumn !== -1 ? sortColumn : null,
          sortDirection: sortDirection !== 'asc' ? sortDirection : null,
          currentPage: currentPage !== 1 ? currentPage : null
        });
      }, [theme, fileUrl, pageSize, separator, andFilter, orFilter, notFilter, caseSensitive, maxColumnWidth, collapsedCols, sortColumn, sortDirection, currentPage]);

      const handleShare = async () => {
        try {
          await navigator.clipboard.writeText(window.location.href);
          alert('URL copied to clipboard!');
        } catch (err) {
          // Fallback for older browsers
          const textArea = document.createElement('textarea');
          textArea.value = window.location.href;
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
          alert('URL copied to clipboard!');
        }
      };

      useEffect(() => {
        if (theme === 'dark') {
          document.documentElement.classList.add('dark');
        } else {
          document.documentElement.classList.remove('dark');
        }
      }, [theme]);

      useEffect(() => {
        if (csvData.headers.length > 0 && columnOrder.length === 0) {
          setColumnOrder(Array.from({ length: csvData.headers.length }, (_, i) => i));
        }
      }, [csvData.headers]);

      useEffect(() => {
        const timer = setTimeout(() => {
          setDebouncedAndFilter(andFilter);
          setDebouncedOrFilter(orFilter);
          setDebouncedNotFilter(notFilter);
        }, 500);
        return () => clearTimeout(timer);
      }, [andFilter, orFilter, notFilter]);

      const handleFileUpload = async (event) => {
        const file = event.target.files?.[0];
        if (file) {
          const text = await file.text();
          parseCSV(text);
        }
      };

      const handleUrlUpload = async (url) => {
        try {
          const response = await fetch(url);
          const text = await response.text();
          parseCSV(text);
          setFileUrl(url);
          setShowUrlInput(false);
        } catch (error) {
          console.error('Error loading CSV from URL:', error);
          alert('Error loading CSV from URL: ' + error.message);
        }
      };

      const handlePasteFromClipboard = async () => {
        try {
          // Try modern Clipboard API first
          if (navigator.clipboard && navigator.clipboard.readText) {
            const text = await navigator.clipboard.readText();
            if (text.trim()) {
              parseCSV(text);
              setFileUrl(''); // Clear URL since we're pasting data
            } else {
              alert('Clipboard is empty or contains no text');
            }
          } else {
            // Fallback method using hidden textarea
            const pasteArea = document.getElementById('pasteArea');
            pasteArea.value = '';
            pasteArea.focus();
            pasteArea.select();
            
            // Show instruction to user
            const userText = prompt('Please paste your CSV data here:', '');
            if (userText && userText.trim()) {
              parseCSV(userText);
              setFileUrl('');
            } else {
              alert('No data provided');
            }
          }
        } catch (error) {
          console.error('Error reading from clipboard:', error);
          // Final fallback - prompt user
          const userText = prompt('Clipboard access failed. Please paste your CSV data here:', '');
          if (userText && userText.trim()) {
            parseCSV(userText);
            setFileUrl('');
          } else {
            alert('No data provided');
          }
        }
      };

      const parseCSV = (text) => {
        const lines = text.split('\n')
          .map(line => line.trim())
          .filter(line => line && !line.startsWith('#'));

        if (lines.length === 0) {
          setCSVData({ headers: [], rows: [] });
          return;
        }

        const headers = lines[0].split(separator).map(h => h.trim());
        const headerCount = headers.length;

        const rows = lines.slice(1).map(line => {
          const cells = line.split(separator).map(cell => cell.trim());
          if (cells.length < headerCount) {
            return [...cells, ...Array(headerCount - cells.length).fill('N/A')];
          } else if (cells.length > headerCount) {
            return cells.slice(0, headerCount);
          }
          return cells;
        });
        setCSVData({ headers, rows });
        setCurrentPage(1);
        setColumnOrder(Array.from({ length: headers.length }, (_, i) => i));
        // Don't reset collapsedCols - preserve URL parameter values
      };

      // Load CSV from URL on initial load
      useEffect(() => {
        if (urlParams.url) {
          handleUrlUpload(urlParams.url);
        }
      }, []);

      const filteredAndSortedData = useMemo(() => {
        let filtered = [...csvData.rows];
        const processText = (text) => caseSensitive ? text : String(text).toLowerCase();

        if (debouncedAndFilter) {
          const terms = debouncedAndFilter.split(' ').filter(Boolean).map(term => processText(term));
          filtered = filtered.filter(row =>
            terms.every(term =>
              row.some(cell => processText(cell).includes(term))
            )
          );
        }

        if (debouncedOrFilter) {
          const terms = debouncedOrFilter.split(' ').filter(Boolean).map(term => processText(term));
          filtered = filtered.filter(row =>
            terms.some(term =>
              row.some(cell => processText(cell).includes(term))
            )
          );
        }

        if (debouncedNotFilter) {
          const terms = debouncedNotFilter.split(' ').filter(Boolean).map(term => processText(term));
          filtered = filtered.filter(row =>
            !terms.some(term =>
              row.some(cell => processText(cell).includes(term))
            )
          );
        }

        if (sortColumn !== -1) {
          // Determine if the column should be treated as numeric: all meaningful values numeric
          const treatAsNumeric = filtered.every(row => {
            const v = row[sortColumn];
            // allow placeholders/empty, but require others to be numeric
            return v === 'N/A' || String(v).trim() === '' || isNumericValue(v);
          });

          filtered.sort((a, b) => {
            const aVal = a[sortColumn];
            const bVal = b[sortColumn];

            if (treatAsNumeric) {
              const aIsNum = isNumericValue(aVal);
              const bIsNum = isNumericValue(bVal);
              if (aIsNum && bIsNum) {
                const aNum = toNumber(aVal);
                const bNum = toNumber(bVal);
                return sortDirection === 'asc' ? aNum - bNum : bNum - aNum;
              }
              if (aIsNum !== bIsNum) {
                // push non-numeric to the end for ascending, to the beginning for descending
                return (sortDirection === 'asc') ? (aIsNum ? -1 : 1) : (aIsNum ? 1 : -1);
              }
              // both non-numeric (e.g., both N/A) -> keep stable-ish using string compare
              const aStr = String(aVal);
              const bStr = String(bVal);
              return sortDirection === 'asc' ? aStr.localeCompare(bStr) : bStr.localeCompare(aStr);
            } else {
              const aStr = caseSensitive ? String(aVal) : String(aVal).toLowerCase();
              const bStr = caseSensitive ? String(bVal) : String(bVal).toLowerCase();
              return sortDirection === 'asc' 
                ? aStr.localeCompare(bStr)
                : bStr.localeCompare(aStr);
            }
          });
        }

        return filtered;
      }, [csvData.rows, debouncedAndFilter, debouncedOrFilter, debouncedNotFilter, sortColumn, sortDirection, caseSensitive]);

      const totalPages = Math.ceil(filteredAndSortedData.length / pageSize) || 1;
      const paginatedData = filteredAndSortedData.slice(
        (currentPage - 1) * pageSize,
        currentPage * pageSize
      );

      const handleDragStart = (index) => {
        setDraggedColumn(index);
      };

      const handleDragOver = (e, index) => {
        e.preventDefault();
        if (draggedColumn === null || draggedColumn === index) return;
        setDragOverColumn(index);
      };

      const handleDrop = (index) => {
        if (draggedColumn === null || draggedColumn === index) return;
        const newOrder = [...columnOrder];
        const draggedItem = newOrder[draggedColumn];
        newOrder.splice(draggedColumn, 1);
        newOrder.splice(index, 0, draggedItem);
        setColumnOrder(newOrder);
        setDraggedColumn(null);
        setDragOverColumn(null);
      };

      const handleDragEnd = () => {
        setDraggedColumn(null);
        setDragOverColumn(null);
      };

      const handleHorizontalScroll = (direction) => {
        const tableContainer = document.querySelector('.table-container');
        if (tableContainer) {
          const scrollAmount = 200;
          const newPosition = direction === 'left' 
            ? Math.max(0, scrollPosition - scrollAmount)
            : scrollPosition + scrollAmount;
          tableContainer.scrollLeft = newPosition;
          setScrollPosition(newPosition);
        }
      };

      const limitForCol = (colIndex) => (collapsedCols.has(colIndex) ? 5 : maxColumnWidth);

      const truncateText = (text, colIndex = null) => {
        if (!text) return '';
        const limit = colIndex === null ? maxColumnWidth : limitForCol(colIndex);
        if (limit === Infinity) return text;
        return text.length > limit ? `${text.slice(0, limit)}...` : text;
      };

      const shouldShowTooltip = (text, colIndex = null) => {
        if (!text) return false;
        if (colIndex !== null && collapsedCols.has(colIndex)) return true;

        const processed = processHtmlContent(text);
        const limit = colIndex === null ? maxColumnWidth : limitForCol(colIndex);
        if (limit === Infinity) return false;

        if (processed.isLink) {
          const totalLength = (processed.beforeText || '').length + processed.label.length + (processed.afterText || '').length;
          return totalLength > limit;
        }
        return text.length > limit;
      };

      const renderCell = (content, colIndex) => {
        if (content === 'N/A') {
          return <span className="text-gray-400 dark:text-gray-500">N/A</span>;
        }
        const processed = processHtmlContent(content);
        if (processed.isLink) {
          return (
            <span>
              {processed.beforeText && (
                <span className="mr-1">{truncateText(processed.beforeText, colIndex)}</span>
              )}
              <a 
                href={processed.url}
                target="_blank"
                rel="noopener noreferrer"
                className="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-200"
              >
                {truncateText(processed.label, colIndex)}
              </a>
              {processed.afterText && (
                <span className="ml-1">{truncateText(processed.afterText, colIndex)}</span>
              )}
            </span>
          );
        }
        return truncateText(content, colIndex);
      };

      const toggleCollapse = (colIndex) => {
        setCollapsedCols(prev => {
          const next = new Set(prev);
          if (next.has(colIndex)) next.delete(colIndex); else next.add(colIndex);
          return next;
        });
      };

      return (
        <div className="min-h-screen bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 w-full">
          <div className="w-full px-4 md:px-6 lg:px-8 py-8">
            <div className="flex flex-wrap items-center gap-4 mb-8">
              {/* Separator selector - leftmost */}
              <div className="relative" data-tooltip="Choose the character that separates columns in your CSV file">
                <select
                  value={separator}
                  onChange={(e) => setSeparator(e.target.value)}
                  className="px-4 py-2 h-[42px] border rounded-lg dark:bg-gray-800 dark:border-gray-700"
                >
                  {separators.map(({ label, value }) => (
                    <option key={value} value={value}>
                      {label}
                    </option>
                  ))}
                </select>
              </div>

              {/* Upload CSV button */}
              <label className="relative cursor-pointer bg-blue-500 hover:bg-blue-600 text-white h-[42px] px-4 flex items-center rounded-lg" data-tooltip="Upload a CSV file from your computer">
                <Icons.Upload className="inline-block mr-2" />
                Upload CSV
                <input
                  type="file"
                  accept=".csv"
                  onChange={handleFileUpload}
                  className="hidden"
                />
              </label>

              {/* Load CSV from URL button */}
              <div className="flex items-center gap-2">
                <button
                  onClick={() => setShowUrlInput(!showUrlInput)}
                  className="bg-blue-500 hover:bg-blue-600 text-white h-[42px] px-4 rounded-lg"
                  data-tooltip="Load CSV file from URL"
                >
                  Load CSV from URL
                </button>
                {showUrlInput && (
                  <div className="flex items-center gap-2">
                    <input
                      type="text"
                      value={fileUrl}
                      onChange={(e) => setFileUrl(e.target.value)}
                      placeholder="Enter CSV URL"
                      className="px-4 py-2 h-[42px] border rounded-lg dark:bg-gray-800 dark:border-gray-700 min-w-[300px]"
                    />
                    <button
                      onClick={() => handleUrlUpload(fileUrl)}
                      className="bg-green-500 hover:bg-green-600 text-white h-[42px] px-4 rounded-lg"
                      data-tooltip="Load the CSV from entered URL"
                    >
                      Load
                    </button>
                  </div>
                )}
              </div>

              {/* Paste CSV button */}
              <button
                onClick={handlePasteFromClipboard}
                className="bg-purple-500 hover:bg-purple-600 text-white h-[42px] px-4 rounded-lg flex items-center"
                data-tooltip="Paste CSV data from clipboard"
              >
                <Icons.Clipboard className="inline-block mr-2" />
                Paste CSV
              </button>

              {/* Spacer to push right-side buttons to the right */}
              <div className="flex-1"></div>

              {/* Share button - on the right */}
              <button
                onClick={handleShare}
                className="bg-green-500 hover:bg-green-600 text-white h-[42px] px-4 rounded-lg flex items-center"
                data-tooltip="Copy current URL with all settings to clipboard"
              >
                <Icons.Share className="inline-block mr-2" />
                Share
              </button>

              {/* Theme selector - rightmost */}
              <button
                onClick={() => setTheme(theme === 'light' ? 'dark' : 'light')}
                className="p-2 h-[42px] w-[42px] rounded-lg bg-gray-200 dark:bg-gray-700 flex items-center justify-center"
                data-tooltip={`Switch to ${theme === 'light' ? 'dark' : 'light'} mode`}
              >
                {theme === 'light' ? <Icons.Moon /> : <Icons.Sun />}
              </button>
            </div>

            <div className="space-y-4 mb-8">
              <div className="flex items-center gap-4">
                <div className="flex-1 relative" data-tooltip-wide="Shows rows that contain ALL specified terms">
                  <input
                    type="text"
                    value={andFilter}
                    onChange={(e) => setAndFilter(e.target.value)}
                    placeholder="AND Filter (space-separated)"
                    className="w-full px-4 py-2 border rounded-lg dark:bg-gray-800 dark:border-gray-700"
                  />
                </div>
                <div className="flex-1 relative" data-tooltip-wide="Shows rows that contain ANY specified term">
                  <input
                    type="text"
                    value={orFilter}
                    onChange={(e) => setOrFilter(e.target.value)}
                    placeholder="OR Filter (space-separated)"
                    className="w-full px-4 py-2 border rounded-lg dark:bg-gray-800 dark:border-gray-700"
                  />
                </div>
                <div className="flex-1 relative" data-tooltip-wide="Excludes rows that contain ANY specified term">
                  <input
                    type="text"
                    value={notFilter}
                    onChange={(e) => setNotFilter(e.target.value)}
                    placeholder="NOT Filter (space-separated)"
                    className="w-full px-4 py-2 border rounded-lg dark:bg-gray-800 dark:border-gray-700"
                  />
                </div>
                <div className="flex items-center gap-2" data-tooltip="Match exact case in filters">
                  <input
                    type="checkbox"
                    id="caseSensitive"
                    checked={caseSensitive}
                    onChange={(e) => setCaseSensitive(e.target.checked)}
                    className="rounded border-gray-300 dark:border-gray-700"
                  />
                  <label htmlFor="caseSensitive" className="text-sm whitespace-nowrap">
                    Case
                  </label>
                </div>
              </div>
            </div>

            <div className="border rounded-lg dark:border-gray-700">
              <div className="flex items-center p-4 bg-gray-50 dark:bg-gray-800 gap-8">
                <div className="flex items-center gap-2">
                  <button
                    onClick={() => handleHorizontalScroll('left')}
                    className="p-2 rounded-lg bg-gray-200 dark:bg-gray-700"
                    data-tooltip="Scroll table left"
                  >
                    <Icons.ArrowLeft />
                  </button>
                  <button
                    onClick={() => handleHorizontalScroll('right')}
                    className="p-2 rounded-lg bg-gray-200 dark:bg-gray-700"
                    data-tooltip="Scroll table right"
                  >
                    <Icons.ArrowRight />
                  </button>
                </div>
                <div className="relative" data-tooltip="Set maximum number of characters to display in each column">
                  <select
                    value={maxColumnWidth}
                    onChange={(e) => setMaxColumnWidth(Number(e.target.value))}
                    className="px-4 py-2 border rounded-lg dark:bg-gray-800 dark:border-gray-700"
                  >
                    {columnWidthOptions.map(({ label, value }) => (
                      <option key={label} value={value}>{label}</option>
                    ))}
                  </select>
                </div>
                <div className="flex items-center gap-4">
                  <div className="relative" data-tooltip="Set number of rows to display per page">
                    <select
                      value={pageSize}
                      onChange={(e) => {
                        setPageSize(Number(e.target.value));
                        setCurrentPage(1);
                      }}
                      className="px-4 py-2 border rounded-lg dark:bg-gray-800 dark:border-gray-700"
                    >
                      {[10, 20, 50, 100, 1000].map(size => (
                        <option key={size} value={size}>{size} rows</option>
                      ))}
                    </select>
                  </div>
                  <span className="text-sm">
                    Page {currentPage} of {totalPages}
                  </span>
                  <div className="flex gap-2">
                    <button
                      onClick={() => setCurrentPage(1)}
                      disabled={currentPage === 1}
                      className="p-2 rounded-lg bg-gray-200 dark:bg-gray-700 disabled:opacity-50"
                      data-tooltip="Go to first page"
                    >
                      <Icons.ChevronFirst />
                    </button>
                    <button
                      onClick={() => setCurrentPage(prev => Math.max(1, prev - 1))}
                      disabled={currentPage === 1}
                      className="p-2 rounded-lg bg-gray-200 dark:bg-gray-700 disabled:opacity-50"
                      data-tooltip="Go to previous page"
                    >
                      <Icons.ArrowUp />
                    </button>
                    <button
                      onClick={() => setCurrentPage(prev => Math.min(totalPages, prev + 1))}
                      disabled={currentPage === totalPages}
                      className="p-2 rounded-lg bg-gray-200 dark:bg-gray-700 disabled:opacity-50"
                      data-tooltip="Go to next page"
                    >
                      <Icons.ArrowDown />
                    </button>
                    <button
                      onClick={() => setCurrentPage(totalPages)}
                      disabled={currentPage === totalPages}
                      className="p-2 rounded-lg bg-gray-200 dark:bg-gray-700 disabled:opacity-50"
                      data-tooltip="Go to last page"
                    >
                      <Icons.ChevronLast />
                    </button>
                  </div>
                </div>
              </div>

              <div className="overflow-x-auto table-container w-full">
                <table className="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                  <thead className="bg-gray-50 dark:bg-gray-800 sticky top-0 z-10">
                    <tr>
                      {columnOrder.map((colIndex) => (
                        <th
                          key={colIndex}
                          draggable
                          onDragStart={() => handleDragStart(colIndex)}
                          onDragOver={(e) => handleDragOver(e, colIndex)}
                          onDrop={() => handleDrop(colIndex)}
                          onDragEnd={handleDragEnd}
                          className={`px-6 py-3 text-left text-xs font-medium uppercase tracking-wider cursor-move relative select-none ${
                            draggedColumn === colIndex ? 'opacity-50 bg-gray-100 dark:bg-gray-700' : ''
                          } ${dragOverColumn === colIndex ? 'border-l-2 border-blue-500' : ''}`}
                          onClick={() => {
                            if (sortColumn === colIndex) {
                              setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc');
                            } else {
                              setSortColumn(colIndex);
                              setSortDirection('asc');
                            }
                          }}
                          title={shouldShowTooltip(csvData.headers[colIndex], colIndex) ? csvData.headers[colIndex] : undefined}
                          style={collapsedCols.has(colIndex) ? { maxWidth: '5ch', width: '5ch' } : undefined}
                        >
                          <div className="flex items-center gap-2">
                            <span className={`block ${collapsedCols.has(colIndex) ? 'overflow-hidden text-ellipsis whitespace-nowrap' : ''}`}>
                              {truncateText(csvData.headers[colIndex], colIndex)}
                            </span>
                            {sortColumn === colIndex && (
                              <Icons.ArrowUpDown className={`transform ${sortDirection === 'desc' ? 'rotate-180' : ''}`} />
                            )}
                            <button
                              draggable={false}
                              onClick={(e) => { e.stopPropagation(); toggleCollapse(colIndex); }}
                              className={`ml-auto px-1 py-0.5 text-[10px] rounded border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 ${collapsedCols.has(colIndex) ? 'bg-gray-100 dark:bg-gray-700' : 'bg-transparent'}`}
                              title={collapsedCols.has(colIndex) ? `Restore column "${csvData.headers[colIndex]}" width` : `Minimize column "${csvData.headers[colIndex]}" to 5 chars`}
                            >
                              {collapsedCols.has(colIndex) ? 'в†”' : '5ch'}
                            </button>
                          </div>
                        </th>
                      ))}
                    </tr>
                  </thead>
                  <tbody className="bg-white divide-y divide-gray-200 dark:bg-gray-900 dark:divide-gray-700">
                    {paginatedData.map((row, rowIndex) => (
                      <tr key={rowIndex}>
                        {columnOrder.map((colIndex) => (
                          <td 
                            key={colIndex}
                            className={`px-6 py-4 text-sm ${collapsedCols.has(colIndex) ? 'overflow-hidden text-ellipsis whitespace-nowrap' : 'whitespace-nowrap'}`}
                            title={shouldShowTooltip(row[colIndex], colIndex) ? row[colIndex] : undefined}
                            style={collapsedCols.has(colIndex) ? { maxWidth: '5ch', width: '5ch' } : undefined}
                          >
                            {renderCell(row[colIndex], colIndex)}
                          </td>
                        ))}
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(
      <StrictMode>
        <App />
      </StrictMode>
    );
  </script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</body>
</html>
